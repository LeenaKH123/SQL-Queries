	SELECT 
		ad.NAS_CODE as 'nas_code',
		(ISNULL(rel.CUSTOMER_NAME, '')+ ' ' + ISNULL(rel.SURNAME_1, '')+ ' ' + ISNULL(rel.SURNAME_2,'')) as 'customer_name',
		ouc_report.i18n_jasper('$P!{Language}',sgt.NAME_TYPE_XI18N, sgt.NAME_TYPE) as 'premise_type',
		ouc_report.i18n_jasper('$P!{Language}',css.NAME_TYPE_XI18N, css.NAME_TYPE) as 'contract_status',
	    ouc_report.i18n_jasper('$P!{Language}',s.NAME_TYPE_XI18N, s.NAME_TYPE) as 'sector',
		ss.NISS as 'sector_supply',
		(SELECT top 1 rsc.RSC_CODE + ' ' + rsc.RSC_CODE_DESC
			FROM GCCOM_RSCODE_CONFIGURATION rsc
			WHERE rsc.ID_SEGMENT = cs.BILLING_CLASS AND rsc.EXCEPTIONAL_TARIFF = cs.COD_EXCTARIFF 
			AND ((rel.NATIONALITY = 18 and rsc.NATIONALITY = 18) OR rsc.NATIONALITY IS NULL) 
			AND rsc.ID_SECTOR = ss.ID_SECTOR) as 'rs_code',
		(SELECT TOP 1 oc.COLLECTION_AMOUNT
			FROM GCCB_ONLINE_COLLECTION oc
			WHERE oc.ID_PAYMENT_FORM = pf.ID_PAYMENT_FORM
			order by oc.COLLECTION_DATE DESC) as 'last_payment_amount',
		(SELECT TOP 1 oc.COLLECTION_DATE
			FROM GCCB_ONLINE_COLLECTION oc
			WHERE oc.ID_PAYMENT_FORM = pf.ID_PAYMENT_FORM
			order by oc.COLLECTION_DATE DESC) as 'last_payment_date',
		( SELECT SUM(gb.PENDING_AMOUNT)
			FROM GCCOM_CONTRACTED_SERVICE gcs
			inner join GCCOM_BILL gb ON gcs.ID_CONTRACTED_SERVICE = gb.ID_CONTRACTED_SERVICE
			WHERE gcs.ID_CONTRACTED_SERVICE = cs.ID_CONTRACTED_SERVICE 
				AND gb.COLLECTION_STATUS IS NOT NULL) as 'outstanding_amount'
	FROM GCCOM_ADDRESS ad
	INNER JOIN GCCOM_SUPPLY sup ON sup.ID_ADDRESS = ad.ID_ADDRESS
	INNER JOIN GCCOM_SECTOR_SUPPLY ss ON ss.ID_SUPPLY = sup.ID_SUPPLY
	INNER JOIN GCCOM_CONTRACTED_SERVICE cs ON cs.ID_SECTOR_SUPPLY = ss.ID_SECTOR_SUPPLY
	INNER JOIN GCCOM_PAYMENT_FORM pf ON pf.id_payment_form = cs.ID_PAYMENT_FORM
	INNER JOIN GCCD_RELATIONSHIP rel ON rel.ID_RELATIONSHIP = pf.ID_CUSTOMER
	LEFT JOIN GCCOM_SEGMENT_GROUP_TYPE sgt ON sgt.COD_DEVELOP = ss.COD_GROUP_SEGMENT
	LEFT JOIN GCCOM_CONTRACT_SERV_STATUS css ON css.COD_DEVELOP = cs.STATUS
	LEFT JOIN GCCOM_SECTOR s ON s.ID_SECTOR = ss.ID_SECTOR
	WHERE (ad.NAS_CODE = '$P!{NasCode}' or '$P!{NasCode}' = '-999' )
	ORDER BY pf.ID_PAYMENT_FORM
