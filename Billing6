	WITH EXCEPTIONS AS
(SELECT 'READING' AS CATEGORY, 
ANOMALY_CODE AS EXCEPTION_CODE, 
OUC_REPORT.I18N_JASPER('$P!{Language}', ANOMALY_DESC_XI18N,ANOMALY_DESC) AS EXCEPTION_DESCRIPTION
FROM GCGT_RE_ANOMALY_MASTER AM
INNER JOIN GCGT_RE_ANOMALY_PARAM AP ON AM.ID_ANOMALY_MASTER = AP.ID_ANOMALY_MASTER
INNER JOIN GCGT_RE_ANOMALY A ON A.ID_ANOMALY_PARAM = AP.ID_ANOMALY_PARAM
INNER JOIN GCGT_RE_ANOMALOUS AN ON A.ID_ANOMALY_PARAM = A.ID_ANOMALY_PARAM
AND AN.STATUS in ('1000ANMSTA', '6000ANMSTA')
UNION ALL
SELECT 
CASE WHEN A.COD_GROUP = '200ANOMGRP' THEN 'USAGE'
WHEN A.COD_GROUP <> '200ANOMGRP' THEN 'BILL' END AS CATEGORY, 
COD_USER AS EXCEPTION_CODE, 
OUC_REPORT.I18N_JASPER('$P!{Language}', AM.NAME_TYPE_XI18N,AM.DESCRIPTION) AS EXCEPTION_DESCRIPTION
FROM GCCOM_BILL_ANOMALY_COMPANY AM
INNER JOIN GCCOM_ANOMALOUS AN ON AN.ID_PRINCIPAL_ANOMALY = AM.ID_BILL_ANOM_COMP
AND AN.ANOMALOUS_STATUS in ('ESTAN00001', 'ESTAN00006','ESTAN00007','ESTAN00009')
INNER JOIN GCCOM_DETECTED_ANOMALY DA ON DA.ID_ANOMALOUS = AN.ID_ANOMALOUS
INNER JOIN GCCOM_ANOMALY_PARAM AP ON DA.ID_ANOMALY_PARAM  = AP.ID_ANOMALY_PARAM
INNER JOIN GCCOM_ANOMALY A ON A.ANOMALY_COD = AM.ANOMALY_COD
INNER JOIN GCCOM_ANOMALY_GROUP AG ON AG.COD_DEVELOP = A.COD_GROUP)
SELECT CATEGORY, EXCEPTION_CODE, EXCEPTION_DESCRIPTION, COUNT(*) AS COUNT
FROM EXCEPTIONS
GROUP BY CATEGORY, EXCEPTION_CODE, EXCEPTION_DESCRIPTION
